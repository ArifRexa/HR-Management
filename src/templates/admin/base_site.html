{% extends "admin/base_site.html" %}

{% load static %}

{% block title %}
    {% if cl.opts.verbose_name_plural %}
        {{ cl.opts.verbose_name_plural|capfirst }}
    {% else %}
        {{ title }}
    {% endif %}
    {% if site_title %}
        | {{ site_title }}
    {% endif %}
{% endblock %}

{% block extrahead %}
    <link rel="icon" href="https://mediusware.com/fav.svg">
    <link rel="shortcut icon" type="image/x-icon"
          href="https://mediusware.com/wp-content/uploads/2021/04/apple-icon-120x120-1.png">
    <style>
        #result_list {
            min-height: 50vh;
        }

        select {
            overflow: overlay;
        }

        ul.messagelist li.alert-danger {
            color: white !important;
            background: red !important;
        }

        .blinking-text {
            animation: blink 1.5s infinite alternate;
        }

        @keyframes blink {
            from { color: red; }
            to { color: #41a6fa; }
        }

        /* Container for h3 and button */
        .filter-header {
            display: flex;
            justify-content: space-between; /* Align h3 and button on opposite ends */
            align-items: center;
        }

        /* Style for the toggle buttons beside h3 */
        .toggle-filter-button {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 18px;
            margin-left: 10px;
            outline: none;
        }

        .toggle-filter-button:focus {
            outline: none;
        }
    </style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get the filter section
        var filterSection = document.querySelector('#changelist-filter');
        if (filterSection) {
            // Get the current URL to match filters
            var currentUrl = window.location.href;

            // Get all h3 elements within the filter section
            var headings = filterSection.querySelectorAll('h3');

            headings.forEach(function(h3) {
                // Skip the "Clear all filters" h3 by checking the ID
                if (h3.id === 'changelist-filter-clear') {
                    return; // Skip this h3
                }

                // Create a wrapper div for h3 and button
                var wrapper = document.createElement('div');
                wrapper.className = 'filter-header';

                // Move the existing h3 content into the wrapper
                wrapper.appendChild(h3.firstChild);

                // Create a button for each h3
                var toggleButton = document.createElement('button');
                toggleButton.className = 'toggle-filter-button';
                toggleButton.setAttribute('aria-label', 'Toggle this list');
                toggleButton.textContent = '+'; // Initially set to '+'

                // Insert the button into the wrapper
                wrapper.appendChild(toggleButton);

                // Insert the wrapper into the DOM
                h3.appendChild(wrapper);

                // Get the next sibling ul element
                var ul = h3.nextElementSibling;
                if (ul && ul.tagName.toLowerCase() === 'ul') {
                    // Initially hide all ul elements
                    ul.style.display = 'none';

                    // Function to toggle visibility of the ul
                    function toggleVisibility() {
                        if (ul.style.display === 'none') {
                            ul.style.display = 'block';
                            toggleButton.textContent = '-';
                        } else {
                            ul.style.display = 'none';
                            toggleButton.textContent = '+';
                        }
                    }

                    // Add click event to toggle visibility of the ul for both button and h3
                    toggleButton.addEventListener('click', toggleVisibility);
                    h3.addEventListener('click', toggleVisibility);

                    // Stop the h3 from toggling the ul when clicking inside the ul (e.g., on an li)
                    ul.addEventListener('click', function(event) {
                        // Prevent hiding the ul when clicking inside it (on a filter item)
                        event.stopPropagation();
                    });

                    // Check if the id of the ul is present in the URL and show it if it matches
                    var ulId = ul.id.replace(/ /g, '_');  // Replace spaces with underscores to match URL format
                   
                    if (currentUrl.includes(ulId+'__exact') || currentUrl.includes(ulId+'__id__exact')) {
                        
                        ul.style.display = 'block'; // Show the ul if the id matches
                        toggleButton.textContent = '-'; // Set button text to '-'
                    }
                }
            });
        }
    });
</script>

{% endblock %}

{% block content %}
    {{ block.super }}
{% endblock %}

{% block footer %}
<div id="footer">
    {% if request.user.is_authenticated %}
        {% include 'admin/partials/_announcement.html' %}
    {% endif %}
</div>
{% endblock %}
