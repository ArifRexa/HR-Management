{% extends "admin/base_site.html" %}

{% block title %}
    Employee Break Graph
{% endblock %}

{% block content %}
    {% load static %}


    <style>
        @import "https://code.highcharts.com/css/highcharts.css";

        #employee-online {
            min-width: 300px;
            max-width: 800px;
            height: 300px;
            margin: 1em auto;
        }

        .highcharts-xrange-series .highcharts-point {
            stroke-width: 1px;
            stroke: gray;
        }

        .highcharts-partfill-overlay {
            fill: #010101;
            fill-opacity: 0.3;
        }

        .highcharts-data-label text {
            fill: white;
            text-shadow: 1px 1px black, -1px 1px black, -1px -1px black, 1px -1px black;
        }

    </style>

    <form action="{% url 'admin:employee.online.graph' %}" method="get">
        <input type="date" name="date">
        <button type="submit">Search</button>
    </form>

    <div id="employee-online"></div>


    <script src="https://code.highcharts.com/highcharts.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.13/moment-timezone-with-data-2012-2022.min.js"></script>


    <script src="https://code.highcharts.com/modules/xrange.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>

    <script>

        let myData =
        {{ graph_data | safe }}

        const categories = myData?.map((data, index) => data[0]);

        var chartData = [];
        for (let i = 0; i < myData.length; i++) {
            for (let j = 0; j < myData[i][1].length; j++) {

                chartData.push({
                    'x': myData[i][1][j],
                    'x2': myData[i][1][++j],
                    'y': i
                });
            }

            console.log(chartData);

        }

        Highcharts.setOptions({
            time: {
                timezone: 'Asia/Dhaka',
                useUTC: true
            }
        });

        Highcharts.chart('employee-online', {
            chart: {
                type: 'xrange',
                styledMode: true
            },
            title: {
                text: 'Employee Activities'
            },
            tooltip: {
                formatter: function () {
                    return 'Active From<b>' + moment(this.x).format('LT') +
                        '</b> to <b>' + moment(this.x2).format('LT') + '</b>';
                }
            },
            xAxis: {
                type: 'datetime',
                dateTimeLabelFormats: {
                    hour: '%I:%M %P',
                    minute: '%I:%M %P'
                }
            },
            yAxis: {
                title: {
                    text: 'Employees'
                },
                categories: categories,
                reversed: true
            },

            series: [{
                name: 'Project 1',
                // pointPadding: 0,
                // groupPadding: 0,
                pointWidth: 20,
                data: chartData,
                dataLabels: {
                    enabled: true
                }
            }]

        });
    </script>

{% endblock %}