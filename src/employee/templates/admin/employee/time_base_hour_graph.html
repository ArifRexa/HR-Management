{% extends "admin/base_site.html" %}

{% block content %}
    {% load static %}

    <style>
        #nav-sidebar{
            display: none;
        }
        #toggle-nav-sidebar{
            display: none;
        }
        button {
            outline: none;
            background: #417690;
            padding: 6px 10px;
            color: white;
            border: 1px solid #417690;
            border-radius: 4px;
            font-weight: 400;
            transition: background 0.15s;
            cursor: pointer;
            margin-right: 6px;
        }
        .content{
            max-width: 100% !important;
        }
        

    </style>

    <script src="{% url 'js-catalog' %}"></script>
    <script src="{% static 'admin/js/core.js' %}"></script>
    <link rel="stylesheet" href="{% static 'admin/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'admin/css/widgets.css' %}">

    {% block content_title %}{% endblock %}

    <div style="display: flex; justify-content: space-between;">
        <div>
            <h1 id="chartTitle">{{ title }} ({{ chart.weekly.total_hour|floatformat:2 }})</h1>
        </div>

        <!-- View Type Buttons -->
        <div >
            <button onclick="updateChart('daily')">Daily</button>
            <button onclick="updateChart('weekly')">Weekly</button>
            <button onclick="updateChart('monthly')">Monthly</button>

            <!-- <button onclick="changeChartType('line')">Line</button> -->
            <!-- <button onclick="changeChartType('bar')">Bar</button> -->
        </div>

        <div>
            <form action="" method="get">
                {{ filter_form.media }}
                {{ filter_form }}
                <button type="submit" class="default">Filter</button>
            </form>
        </div>
    </div>

    

    <!-- Chart Type Buttons -->
    <!-- <div style="margin: 15px 0;">
        <button onclick="changeChartType('line')">Line</button>
        <button onclick="changeChartType('bar')">Bar</button>
    </div> -->

    <div id="main">
        <canvas id="hourChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const chartData = {{ chart|safe }};
        const ctx = document.getElementById('hourChart').getContext('2d');

        // Default configuration
        let currentView = 'weekly';
        let currentType = 'line';

        function getConfig(type, view) {
            return {
                type: type,
                data: {
                    labels: chartData[view].labels,
                    datasets: [{
                        label: chartData[view].label,
                        data: chartData[view].data,
                        extraInfo: chartData[view].per_day_count,
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgb(75, 192, 192)',
                            'rgb(255, 99, 132)',
                            'rgb(255, 206, 86)',
                            'rgb(54, 162, 235)',
                            'rgb(153, 102, 255)',
                            'rgb(255, 159, 64)'
                        ],
                        borderWidth: 1,
                        fill: type === 'line' ? true : false,
                        tension: type === 'line' ? 0.3 : 0 // smooth curve for line
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            enabled: true,
                            bodyFont: {
                                size: 16  // increase body font size
                            },
                            titleFont: {
                                size: 18  // optional: tooltip title font size
                            },
                            footerFont: {
                                size: 14  // optional: tooltip footer font size
                            },
                            callbacks: {
                                // label: function(context) {
                                //     return context.raw;
                                // },
                                footer: function(context) {
                                    const dataset = context[0].dataset;
                                    const index = context[0].dataIndex;
                                    if (dataset.extraInfo.length === 0) {
                                        return '';
                                    }
                                    const extra = dataset.extraInfo[index];
                                    return `${extra.length}(${extra})`;
                                },
                            }
                        },
                        legend: {
                            labels: {
                                font: {
                                    size: 14  // legend font size
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };
        }

        let myChart = new Chart(ctx, getConfig(currentType, currentView));

        function updateChart(view) {
            currentView = view;
            myChart.destroy();
            myChart = new Chart(ctx, getConfig(currentType, currentView));

            document.getElementById("chartTitle").innerText =
                "{{ title }} (" + chartData[view].total_hour.toFixed(2) + ")";
        }

        function changeChartType(type) {
            currentType = type;
            myChart.destroy();
            myChart = new Chart(ctx, getConfig(currentType, currentView));
        }
    </script>
{% endblock %}
