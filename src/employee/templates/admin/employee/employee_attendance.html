{% extends "admin/base_site.html" %}

{% block title %}
    Employee Attendance
{% endblock %}

{% block content %}

{% load humanize %}
{% load static %}

<link 
    rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" 
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous"
/>
<style>
    /* Table Caption Fix for Django Admin Navbar (Bootstrap Override) */
    table {
        caption-side: unset !important;
    }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" 
    integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" 
    crossorigin="anonymous" referrerpolicy="no-referrer" 
/>
<link rel="stylesheet" href="{% static 'css/list.css' %}">

<style>
    .table__row:nth-child(odd) {
        background: #f8f8f8;
    }
    .table__row:nth-child(even) {
        background: white;
    }
    td, th {
        white-space: nowrap;
    }
    .icon-flipped {
        transform: scaleX(-1);
        -moz-transform: scaleX(-1);
        -webkit-transform: scaleX(-1);
        -ms-transform: scaleX(-1);
    }
    .color-muted {
        color: #bbb;
    }
    .twopx_font {
        font-size: 18px;
    }
</style>

<div class="container-fluid">
    <h2 class="h2 text-center py-3">Employee Attendance</h2>
    <div class="d-flex justify-content-end pb-3">
        <a class="btn btn-secondary text-white px-3" href="{% url 'admin:employee_attendance' %}admin/">Old View</a>
    </div>
    <div class="table-responsive">
        <table class="table w-100 table-bordered">
            <thead>
                <tr class="table__row">
                    <th scope="col" rowspan="2" class="align-middle text-dark border" style="width: 16%;">Employee</th>
                </tr>
                <tr class="table__row">
                    {% for date in dates %}
                        <th class="border text-dark text-center">
                            {{ date|date:"M d" }}
                        </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for employee, date_data in date_datas.items %}
                <tr class="table__row">
                    <td class="align-middle">{{ employee.full_name }}</td>
                    {% for date, data in date_data.items %}
                        {% if data %}
                            <td>
                                <p>
                                    {% comment %} <i class="fa-solid fa-right-from-bracket" style="color: #008631;"></i> {% endcomment %}
                                    <span {% if data.entry_time.hour > 13 %}class="text-danger fw-bold"{% endif %}>
                                        {{ data.entry_time|time:"h:i A" }}
                                    </span>
                                </p>
                                <p>
                                    {% comment %} <i class="fa-solid fa-right-from-bracket icon-flipped" style="color: #c61a09;"></i> {% endcomment %}
                                    <span {% if data.exit_time == '-' %}class="color-muted"{% endif %} >
                                        {% if data.exit_time != '-' %}
                                            {{ data.exit_time|time:"h:i A" }}
                                        {% else %}
                                            {{ data.exit_time }}
                                        {% endif %}
                                    </span>
                                </p>
                                <p>
                                    <span {% if data.break_time_hour >= 1 %}class="twopx_font"{% endif %}>
                                        {{ data.break_time }}
                                    </span>
                                </p>
                                <p>
                                    <span {% if data.inside_time_hour >= 5 %}class="text-success"{% endif %}>
                                        {{ data.inside_time }}
                                    </span>
                                </p>
                            </td>
                        {% else %}
                            <td class="align-middle text-center color-muted"> - </td>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
                </tr>
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
